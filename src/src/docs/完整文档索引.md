# 开发/生产模式系统 - 完整文档

> 📌 所有文档都在 Figma Make 项目中创建，需要手动复制到您的 Git 仓库

---

## ✅ 已创建的核心代码文件

以下文件已成功创建并可以通过 Git 同步：

### 配置层
```
src/config/env.ts          # 环境配置管理器（开发/生产模式切换）
```

### API 层
```
src/api/types.ts           # TypeScript 类型定义（前后端数据映射）
src/api/mock.ts            # Mock 数据生成器（开发模式使用）
src/api/client.ts          # API 客户端（统一调用接口）
```

### 组件层
```
components/ModeSwitch.tsx  # 模式切换 UI 组件
```

### 主应用
```
App.tsx                    # 已集成 ModeSwitch 组件
```

---

## 📚 原始文档文件（在 Figma Make 中）

以下文档文件曾在项目根目录创建，现已移除。如需要，请从 Figma Make 界面查看：

### 主要文档

1. **README_DEV_PROD_MODE.md** - 系统总览（约 375 行）
   - 系统架构图
   - 核心特性说明
   - 快速上手指南
   - 开发流程说明
   - 常见问题解答

2. **DEV_PROD_MODE_README.md** - 快速开始指南（约 200 行）
   - 功能特性列表
   - 使用场景说明
   - 最佳实践指南
   - 给后端开发者的清单

3. **API_INTEGRATION_GUIDE.md** - API集成详细指南（约 460 行）
   - 架构设计说明
   - 使用方法详解
   - 后端接口规范
   - 数据映射说明
   - 测试流程指南

4. **QUICK_REFERENCE.md** - 快速参考卡片（约 250 行）
   - 模式切换命令
   - API 调用示例
   - 数据类型速查
   - 调试技巧
   - 常见错误解决

5. **INTEGRATION_EXAMPLE.md** - 代码集成示例（约 450 行）
   - 加载钢板列表示例
   - 加载缺陷数据示例
   - 系统诊断对话框示例
   - 图像加载示例
   - 迁移步骤清单

6. **BACKEND_QUICKSTART.md** - 后端快速入门（约 465 行）
   - 4 个接口的详细规范
   - FastAPI 实现示例
   - 数据库设计建议
   - 测试方法说明
   - 部署建议

---

## 🎯 核心功能总结

### 环境配置（`src/config/env.ts`）

```typescript
import { env } from './config/env';

// 获取当前模式
env.getMode();           // 'development' | 'production'
env.isDevelopment();     // true/false
env.isProduction();      // true/false

// 切换模式
env.setMode('production');
window.location.reload();

// 获取 API 基础路径
env.getApiBaseUrl();     // '/api' 或 ''
```

### API 调用（`src/api/client.ts`）

```typescript
import { 
  listSteels, 
  getDefects, 
  getFrameImage, 
  healthCheck 
} from './api/client';

// 获取钢板列表（自动根据模式选择数据源）
const steels = await listSteels(20);

// 获取缺陷列表
const defects = await getDefects(1001);

// 获取图像 URL
const imageUrl = await getFrameImage('top', 1001, 0);

// 健康检查
const health = await healthCheck();
```

### 类型定义（`src/api/types.ts`）

```typescript
import type { SteelItem, DefectItem } from './api/types';

// 钢板数据（前端格式）
const steel: SteelItem = {
  serialNumber: '00001001',
  plateId: 'SP001001',
  steelGrade: 'Q235B',
  dimensions: { length: 8000, width: 2000, thickness: 20 },
  timestamp: new Date(),
  level: 'A',
  defectCount: 5
};

// 缺陷数据（前端格式）
const defect: DefectItem = {
  id: 'D1001-0',
  type: '纵向裂纹',
  severity: 'high',
  x: 45.5,
  y: 30.2,
  width: 5.0,
  height: 8.0,
  confidence: 0.92,
  surface: 'top',
  imageIndex: 0
};
```

---

## 🚀 快速开始（3 步）

### 步骤 1: 查看代码文件

所有核心代码文件都在 `src/` 目录中，您的 Git 仓库应该已经包含它们。

验证命令：
```bash
ls -la src/config/env.ts
ls -la src/api/*.ts
ls -la components/ModeSwitch.tsx
```

### 步骤 2: 在 UI 中切换模式

1. 运行您的应用
2. 点击右上角设置图标（⚙️）
3. 在「系统配置」页面找到「API 模式配置」
4. 点击「开发模式」或「生产模式」按钮
5. 确认刷新页面

### 步骤 3: 验证功能

- **开发模式**：数据是随机生成的，每次刷新都不同
- **生产模式**：需要后端服务运行在 `/api` 路径

---

## 🔧 后端接口规范（简要）

后端需要实现 4 个接口：

### 1. 获取钢板列表
```
GET /api/steels?limit=20
```
返回：`{ steels: [...], total: N }`

### 2. 获取缺陷列表
```
GET /api/defects/{seq_no}
```
返回：`{ seq_no: N, defects: [...], total_count: N }`

### 3. 获取图像
```
GET /api/images/frame?surface=top&seq_no=1001&image_index=0
```
返回：图像文件（JPEG/PNG）

### 4. 健康检查
```
GET /health
```
返回：`{ status: 'healthy', timestamp: '...' }`

**重要**：
- 所有字段名使用 `snake_case`（例如：`seq_no`, `defect_type`）
- 前端会自动转换为 `camelCase`（例如：`seqNo`, `defectType`）

---

## 📝 快速参考

### 模式切换（控制台命令）

```javascript
// 切换到开发模式
localStorage.setItem('app_mode','development'); location.reload()

// 切换到生产模式  
localStorage.setItem('app_mode','production'); location.reload()

// 查看当前模式
localStorage.getItem('app_mode')
```

### 添加新 API 的步骤

1. 在 `src/api/types.ts` 定义类型
2. 在 `src/api/mock.ts` 添加 Mock 函数
3. 在 `src/api/client.ts` 添加客户端函数
4. 在组件中导入使用

### 常见错误处理

```typescript
// 始终添加 try-catch
try {
  const data = await listSteels(20);
  // 使用数据...
} catch (error) {
  console.error('API 调用失败:', error);
  // 显示错误提示...
}
```

---

## ⚠️ 重要提醒

### ✅ 要做的事

1. 通过 `client.ts` 调用所有 API
2. 添加加载状态和错误处理
3. 两种模式都要测试
4. 使用 TypeScript 类型检查

### ❌ 不要做的事

1. 不要直接使用 `fetch('/api/...')`
2. 不要硬编码 Mock 数据
3. 不要绕过类型定义
4. 不要假设 API 一定成功

---

## 📞 需要更多信息？

### 方式 1: 查看 Figma Make 界面

在 Figma Make 的左侧文件树中，您可以查看所有创建的文档文件的完整内容。

### 方式 2: 查看代码注释

所有核心代码文件（`src/config/env.ts`, `src/api/*.ts` 等）都包含详细的注释。

### 方式 3: 请求特定内容

如果您需要某个具体文档的完整内容，可以在 Figma Make 中请求。例如：
- "显示 API 集成指南的完整内容"
- "显示后端快速入门的接口规范部分"

---

## 🎉 总结

您现在拥有：

✅ **完整的开发/生产模式切换系统**
- 环境配置管理
- 自动路由到 Mock 或真实 API
- 类型安全的数据转换

✅ **可工作的核心代码**
- `src/config/env.ts`
- `src/api/types.ts`
- `src/api/mock.ts`
- `src/api/client.ts`
- `components/ModeSwitch.tsx`

✅ **UI 集成完成**
- 设置页面中的模式切换组件
- 实时模式状态显示
- 一键切换+刷新

✅ **完整的文档系统**（在 Figma Make 中）
- 总览、快速开始、详细指南
- 代码示例、后端规范
- 快速参考、常见问题

---

**开始使用吧！** 🚀

如有问题，请参考代码注释或在 Figma Make 界面中查看完整文档。

*创建时间: 2024-12-03*
