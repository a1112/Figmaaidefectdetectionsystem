# API é›†æˆæŒ‡å— - å¼€å‘/ç”Ÿäº§æ¨¡å¼

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨å¼€å‘/ç”Ÿäº§æ¨¡å¼æ¥åè°ƒå‰åç«¯å¼€å‘å·¥ä½œã€‚

---

## ğŸ“‹ æ¦‚è¿°

ç³»ç»Ÿç°å·²æ”¯æŒ**å¼€å‘æ¨¡å¼**å’Œ**ç”Ÿäº§æ¨¡å¼**çš„æ— ç¼åˆ‡æ¢ï¼š

- **å¼€å‘æ¨¡å¼**ï¼šä½¿ç”¨ Mock æ•°æ®ï¼Œå‰ç«¯å¯ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- **ç”Ÿäº§æ¨¡å¼**ï¼šè¿æ¥çœŸå®çš„ FastAPI åç«¯

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ env.ts           # ç¯å¢ƒé…ç½®ç®¡ç†
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ types.ts         # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ mock.ts          # Mock æ•°æ®ç”Ÿæˆå™¨
â”‚   â””â”€â”€ client.ts        # API å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨åˆ‡æ¢ï¼‰
components/
â””â”€â”€ ModeSwitch.tsx       # æ¨¡å¼åˆ‡æ¢ UI ç»„ä»¶
```

### æ ¸å¿ƒæœºåˆ¶

1. **ç¯å¢ƒé…ç½®** (`src/config/env.ts`)
   - ç®¡ç†å½“å‰æ¨¡å¼ï¼ˆdevelopment/productionï¼‰
   - æŒä¹…åŒ–åˆ° localStorage
   - æä¾›æ¨¡å¼åˆ‡æ¢äº‹ä»¶é€šçŸ¥

2. **ç±»å‹ç³»ç»Ÿ** (`src/api/types.ts`)
   - å®šä¹‰åç«¯æ•°æ®ç»“æ„ï¼ˆsnake_caseï¼‰
   - å®šä¹‰å‰ç«¯æ•°æ®ç»“æ„ï¼ˆcamelCaseï¼‰
   - æä¾›æ˜ å°„è½¬æ¢å‡½æ•°

3. **Mock å±‚** (`src/api/mock.ts`)
   - æ¨¡æ‹Ÿåç«¯ API å“åº”
   - ç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®
   - æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ

4. **API å®¢æˆ·ç«¯** (`src/api/client.ts`)
   - ç»Ÿä¸€çš„ API è°ƒç”¨æ¥å£
   - æ ¹æ®æ¨¡å¼è‡ªåŠ¨è·¯ç”±åˆ° Mock æˆ–çœŸå® API
   - é”™è¯¯å¤„ç†å’Œç±»å‹è½¬æ¢

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å‰ç«¯ç‹¬ç«‹å¼€å‘ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

é»˜è®¤æ¨¡å¼ï¼Œæ— éœ€åç«¯å³å¯å¼€å§‹å¼€å‘ï¼š

```typescript
import { listSteels, getDefects } from './src/api/client';

// è‡ªåŠ¨ä½¿ç”¨ Mock æ•°æ®
const steels = await listSteels(20);
const defects = await getDefects(1001);
```

### 2. åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼

åœ¨ç³»ç»Ÿè®¾ç½®ç•Œé¢ï¼Œç‚¹å‡»ã€Œç”Ÿäº§æ¨¡å¼ã€æŒ‰é’®ï¼š

1. æ‰“å¼€åº”ç”¨
2. ç‚¹å‡»å³ä¸Šè§’è®¾ç½®å›¾æ ‡ï¼ˆâš™ï¸ï¼‰
3. åœ¨ã€ŒAPI æ¨¡å¼é…ç½®ã€é¢æ¿ä¸­é€‰æ‹©ã€Œç”Ÿäº§æ¨¡å¼ã€
4. ç¡®è®¤åˆ·æ–°é¡µé¢

### 3. åœ¨ä»£ç ä¸­ä½¿ç”¨ API

æ‰€æœ‰ API è°ƒç”¨éƒ½é€šè¿‡ `client.ts`ï¼Œæ— éœ€å…³å¿ƒå½“å‰æ¨¡å¼ï¼š

```typescript
import { listSteels, getDefects, getFrameImage, healthCheck } from './src/api/client';

// è·å–é’¢æ¿åˆ—è¡¨
const steels = await listSteels(20);

// è·å–ç¼ºé™·åˆ—è¡¨
const defects = await getDefects(seqNo);

// è·å–å›¾åƒ URL
const imageUrl = await getFrameImage('top', seqNo, 0);

// å¥åº·æ£€æŸ¥
const health = await healthCheck();
```

---

## ğŸ”§ åç«¯é›†æˆæ­¥éª¤

### åç«¯å¼€å‘è€…éœ€è¦å®ç°çš„æ¥å£

æ ¹æ® `guidelines/Guidelines.md`ï¼Œéœ€è¦å®ç°ä»¥ä¸‹ APIï¼š

#### 1. è·å–é’¢æ¿åˆ—è¡¨
```
GET /api/steels?limit=20
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "steels": [
    {
      "seq_no": 1001,
      "steel_no": "SP001001",
      "steel_type": "Q235B",
      "length": 8000,
      "width": 2000,
      "thickness": 20,
      "timestamp": "2024-12-03T10:30:00Z",
      "level": "A",
      "defect_count": 5
    }
  ],
  "total": 1
}
```

#### 2. è·å–ç¼ºé™·åˆ—è¡¨
```
GET /api/defects/{seq_no}
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "seq_no": 1001,
  "defects": [
    {
      "defect_id": "D1001-0",
      "defect_type": "çºµå‘è£‚çº¹",
      "severity": "high",
      "x": 45.5,
      "y": 30.2,
      "width": 5.0,
      "height": 8.0,
      "confidence": 0.92,
      "surface": "top",
      "image_index": 0
    }
  ],
  "total_count": 1
}
```

#### 3. è·å–ç¼ºé™·å›¾åƒ
```
GET /api/images/frame?surface=top&seq_no=1001&image_index=0
```

è¿”å›å›¾åƒæ–‡ä»¶ï¼ˆJPEG/PNGï¼‰

#### 4. å¥åº·æ£€æŸ¥
```
GET /health
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2024-12-03T10:30:00Z",
  "version": "v2.0.1",
  "database": {
    "connected": true,
    "latency_ms": 8.5
  }
}
```

---

## ğŸ”€ æ•°æ®æ˜ å°„

### åç«¯ â†’ å‰ç«¯å­—æ®µæ˜ å°„

#### é’¢æ¿æ•°æ®
| åç«¯ (snake_case) | å‰ç«¯ (camelCase) | è¯´æ˜ |
|------------------|-----------------|------|
| seq_no | serialNumber | æµæ°´å· |
| steel_no | plateId | é’¢æ¿å· |
| steel_type | steelGrade | é’¢ç§ |
| length, width, thickness | dimensions.{} | è§„æ ¼ |
| timestamp | timestamp | æ—¶é—´æˆ³ |
| level | level | ç­‰çº§ |
| defect_count | defectCount | ç¼ºé™·æ•° |

#### ç¼ºé™·æ•°æ®
| åç«¯ (snake_case) | å‰ç«¯ (camelCase) | è¯´æ˜ |
|------------------|-----------------|------|
| defect_id | id | ç¼ºé™·ID |
| defect_type | type | ç¼ºé™·ç±»å‹ |
| image_index | imageIndex | å›¾åƒç´¢å¼• |

æ˜ å°„å‡½æ•°å·²åœ¨ `src/api/types.ts` ä¸­å®šä¹‰ï¼š
- `mapSteelItem(raw)` - è½¬æ¢é’¢æ¿æ•°æ®
- `mapDefectItem(raw)` - è½¬æ¢ç¼ºé™·æ•°æ®

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### å‰ç«¯æµ‹è¯•ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

1. ç¡®ä¿åœ¨å¼€å‘æ¨¡å¼
2. ä½¿ç”¨ Mock æ•°æ®æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
3. éªŒè¯ UI äº¤äº’å’Œæ•°æ®å±•ç¤º

### é›†æˆæµ‹è¯•ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰

1. ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8000`ï¼ˆæˆ–é…ç½®çš„ç«¯å£ï¼‰
2. åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼
3. åˆ·æ–°é¡µé¢
4. éªŒè¯ï¼š
   - é’¢æ¿åˆ—è¡¨æ­£ç¡®åŠ è½½
   - ç‚¹å‡»é’¢æ¿æ˜¾ç¤ºçœŸå®ç¼ºé™·æ•°æ®
   - å›¾åƒæ­£ç¡®æ˜¾ç¤º
   - ç³»ç»Ÿè¯Šæ–­æ˜¾ç¤ºçœŸå®å¥åº·çŠ¶æ€

### è°ƒè¯•æŠ€å·§

#### æ£€æŸ¥å½“å‰æ¨¡å¼
```typescript
import { getApiStatus } from './src/api/client';

const status = getApiStatus();
console.log(status);
// { mode: 'development', description: 'å¼€å‘æ¨¡å¼ - ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', baseUrl: 'Mock Data' }
```

#### æ‰‹åŠ¨åˆ‡æ¢æ¨¡å¼
```typescript
import { env } from './src/config/env';

env.setMode('production');
window.location.reload();
```

#### æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

- **å¼€å‘æ¨¡å¼**ï¼šNetwork ä¸­ä¸ä¼šçœ‹åˆ° `/api/*` è¯·æ±‚
- **ç”Ÿäº§æ¨¡å¼**ï¼šNetwork ä¸­å¯ä»¥çœ‹åˆ°çœŸå®çš„ API è°ƒç”¨

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å‰ç«¯å¼€å‘è€…

1. **å§‹ç»ˆé€šè¿‡ `client.ts` è°ƒç”¨ API**
   - âŒ ä¸è¦ç›´æ¥ä½¿ç”¨ `fetch('/api/...')`
   - âœ… ä½¿ç”¨ `await listSteels()`

2. **å¤„ç†é”™è¯¯**
   - ç”Ÿäº§æ¨¡å¼ä¸‹ API å¯èƒ½å¤±è´¥
   - æ·»åŠ  try-catch å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

3. **æµ‹è¯•ä¸¤ç§æ¨¡å¼**
   - ç¡®ä¿åŠŸèƒ½åœ¨ä¸¤ç§æ¨¡å¼ä¸‹éƒ½æ­£å¸¸å·¥ä½œ
   - ç‰¹åˆ«æ³¨æ„æ•°æ®æ ¼å¼å’Œè¾¹ç•Œæƒ…å†µ

### åç«¯å¼€å‘è€…

1. **éµå¾ªæ•°æ®æ ¼å¼**
   - ä¸¥æ ¼æŒ‰ç…§ `src/api/types.ts` ä¸­çš„ç±»å‹å®šä¹‰è¿”å›æ•°æ®
   - ä½¿ç”¨ snake_case å‘½å

2. **CORS é…ç½®**
   - å¦‚æœå‰åç«¯åˆ†ç¦»éƒ¨ç½²ï¼Œéœ€è¦é…ç½® CORS
   - å…è®¸å‰ç«¯åŸŸåè®¿é—®

3. **é”™è¯¯å¤„ç†**
   - è¿”å›æ ‡å‡†çš„ HTTP çŠ¶æ€ç 
   - æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ”„ éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
- å‰ç«¯ï¼š`npm run dev` (Vite å¼€å‘æœåŠ¡å™¨)
- åç«¯ï¼š`uvicorn main:app --reload`
- å‰ç«¯ä½¿ç”¨å¼€å‘æ¨¡å¼è¿›è¡Œ UI è°ƒè¯•

### æµ‹è¯•ç¯å¢ƒ
- å‰ç«¯åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼
- è¿æ¥åˆ°æµ‹è¯•ç¯å¢ƒçš„åç«¯ API
- è¿›è¡Œé›†æˆæµ‹è¯•

### ç”Ÿäº§ç¯å¢ƒ
- å‰ç«¯æ„å»ºï¼š`npm run build`
- éƒ¨ç½²é™æ€æ–‡ä»¶
- é»˜è®¤ä½¿ç”¨ç”Ÿäº§æ¨¡å¼
- å¯é€šè¿‡ç³»ç»Ÿè®¾ç½®åˆ‡æ¢å›å¼€å‘æ¨¡å¼ï¼ˆç”¨äºè°ƒè¯•ï¼‰

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šåˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼åæ— æ•°æ®

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network
3. æŸ¥çœ‹ `/api/*` è¯·æ±‚æ˜¯å¦è¿”å› 404 æˆ–å…¶ä»–é”™è¯¯
4. æ£€æŸ¥åç«¯æ—¥å¿—

### é—®é¢˜ï¼šæ•°æ®æ ¼å¼ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆï¼š**
1. å¯¹æ¯”åç«¯è¿”å›çš„ JSON å’Œ `src/api/types.ts` ä¸­çš„å®šä¹‰
2. ç¡®è®¤å­—æ®µåæ˜¯ snake_case
3. æ£€æŸ¥æ˜ å°„å‡½æ•°æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šå›¾åƒæ— æ³•åŠ è½½

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤å›¾åƒ URL æ ¼å¼æ­£ç¡®
2. æ£€æŸ¥å›¾åƒæ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. éªŒè¯ CORS é…ç½®ï¼ˆå¦‚æœè·¨åŸŸï¼‰

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `guidelines/Guidelines.md` - åç«¯ API è§„èŒƒ
- `src/config/env.ts` - ç¯å¢ƒé…ç½®
- `src/api/types.ts` - ç±»å‹å®šä¹‰
- `src/api/mock.ts` - Mock æ•°æ®
- `src/api/client.ts` - API å®¢æˆ·ç«¯
- `components/ModeSwitch.tsx` - UI æ§ä»¶

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä»£ç æ³¨é‡Šæˆ–æŸ¥é˜…æœ¬æ–‡æ¡£ã€‚
